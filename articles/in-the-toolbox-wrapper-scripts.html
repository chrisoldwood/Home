<html xmlns:o="urn:schemas-microsoft-com:office:office"
xmlns:w="urn:schemas-microsoft-com:office:word"
xmlns:st1="urn:schemas-microsoft-com:office:smarttags"
xmlns="http://www.w3.org/TR/REC-html40">

<head>
<meta http-equiv=Content-Type content="text/html; charset=windows-1252">
<meta name=ProgId content=Word.Document>
<meta name=Generator content="Microsoft Word 11">
<meta name=Originator content="Microsoft Word 11">
<link rel=File-List href="in-the-toolbox-wrapper-scripts_files/filelist.xml">
<title>In The Tool Box – Wrapper Scripts</title>
<o:SmartTagType namespaceuri="urn:schemas-microsoft-com:office:smarttags"
 name="place"/>
<o:SmartTagType namespaceuri="urn:schemas-microsoft-com:office:smarttags"
 name="stockticker"/>
<o:SmartTagType namespaceuri="urn:schemas-microsoft-com:office:smarttags"
 name="PersonName"/>
<!--[if gte mso 9]><xml>
 <o:DocumentProperties>
  <o:Author>Chris Oldwood</o:Author>
  <o:LastAuthor>Chris Oldwood</o:LastAuthor>
  <o:Revision>2</o:Revision>
  <o:TotalTime>3931</o:TotalTime>
  <o:Created>2013-07-25T06:44:00Z</o:Created>
  <o:LastSaved>2013-07-25T06:44:00Z</o:LastSaved>
  <o:Pages>1</o:Pages>
  <o:Words>2332</o:Words>
  <o:Characters>13293</o:Characters>
  <o:Company>Co Productions Ltd</o:Company>
  <o:Lines>110</o:Lines>
  <o:Paragraphs>31</o:Paragraphs>
  <o:CharactersWithSpaces>15594</o:CharactersWithSpaces>
  <o:Version>11.9999</o:Version>
 </o:DocumentProperties>
</xml><![endif]--><!--[if gte mso 9]><xml>
 <w:WordDocument>
  <w:SpellingState>Clean</w:SpellingState>
  <w:GrammarState>Clean</w:GrammarState>
  <w:ValidateAgainstSchemas/>
  <w:SaveIfXMLInvalid>false</w:SaveIfXMLInvalid>
  <w:IgnoreMixedContent>false</w:IgnoreMixedContent>
  <w:AlwaysShowPlaceholderText>false</w:AlwaysShowPlaceholderText>
  <w:Compatibility>
   <w:BreakWrappedTables/>
   <w:SnapToGridInCell/>
   <w:WrapTextWithPunct/>
   <w:UseAsianBreakRules/>
   <w:UseWord2002TableStyleRules/>
  </w:Compatibility>
  <w:BrowserLevel>MicrosoftInternetExplorer4</w:BrowserLevel>
 </w:WordDocument>
</xml><![endif]--><!--[if gte mso 9]><xml>
 <w:LatentStyles DefLockedState="false" LatentStyleCount="156">
 </w:LatentStyles>
</xml><![endif]--><!--[if !mso]><object
 classid="clsid:38481807-CA0E-42D2-BF39-B33AF135CC4D" id=ieooui></object>
<style>
st1\:*{behavior:url(#ieooui) }
</style>
<![endif]-->
<style>
<!--
 /* Style Definitions */
 p.MsoNormal, li.MsoNormal, div.MsoNormal
	{mso-style-parent:"";
	margin:0cm;
	margin-bottom:.0001pt;
	mso-pagination:widow-orphan;
	font-size:12.0pt;
	font-family:"Times New Roman";
	mso-fareast-font-family:"Times New Roman";
	mso-ansi-language:EN-GB;}
h1
	{mso-style-next:Normal;
	margin-top:12.0pt;
	margin-right:0cm;
	margin-bottom:3.0pt;
	margin-left:0cm;
	mso-pagination:widow-orphan;
	page-break-after:avoid;
	mso-outline-level:1;
	font-size:16.0pt;
	font-family:Arial;
	mso-font-kerning:16.0pt;
	mso-ansi-language:EN-GB;}
h3
	{mso-style-next:Normal;
	margin-top:12.0pt;
	margin-right:0cm;
	margin-bottom:3.0pt;
	margin-left:0cm;
	mso-pagination:widow-orphan;
	page-break-after:avoid;
	mso-outline-level:3;
	font-size:13.0pt;
	font-family:Arial;
	mso-ansi-language:EN-GB;}
a:link, span.MsoHyperlink
	{color:blue;
	text-decoration:underline;
	text-underline:single;}
a:visited, span.MsoHyperlinkFollowed
	{color:purple;
	text-decoration:underline;
	text-underline:single;}
code
	{font-family:"Courier New";
	mso-ascii-font-family:"Courier New";
	mso-fareast-font-family:"Times New Roman";
	mso-hansi-font-family:"Courier New";
	mso-bidi-font-family:"Courier New";}
span.SpellE
	{mso-style-name:"";
	mso-spl-e:yes;}
span.GramE
	{mso-style-name:"";
	mso-gram-e:yes;}
@page Section1
	{size:612.0pt 792.0pt;
	margin:72.0pt 90.0pt 72.0pt 90.0pt;
	mso-header-margin:35.4pt;
	mso-footer-margin:35.4pt;
	mso-paper-source:0;}
div.Section1
	{page:Section1;
	width: 600px;
	margin-left: auto;
	margin-right: auto;}
 /* List Definitions */
 @list l0
	{mso-list-id:1795445013;
	mso-list-type:hybrid;
	mso-list-template-ids:-2035012316 67698703 67698713 67698715 67698703 67698713 67698715 67698703 67698713 67698715;}
@list l0:level1
	{mso-level-tab-stop:36.0pt;
	mso-level-number-position:left;
	text-indent:-18.0pt;}
ol
	{margin-bottom:0cm;}
ul
	{margin-bottom:0cm;}
-->
</style>
<!--[if gte mso 10]>
<style>
 /* Style Definitions */
 table.MsoNormalTable
	{mso-style-name:"Table Normal";
	mso-tstyle-rowband-size:0;
	mso-tstyle-colband-size:0;
	mso-style-noshow:yes;
	mso-style-parent:"";
	mso-padding-alt:0cm 5.4pt 0cm 5.4pt;
	mso-para-margin:0cm;
	mso-para-margin-bottom:.0001pt;
	mso-pagination:widow-orphan;
	font-size:10.0pt;
	font-family:"Times New Roman";
	mso-ansi-language:#0400;
	mso-fareast-language:#0400;
	mso-bidi-language:#0400;}
</style>
<![endif]-->
</head>

<body lang=EN-US link=blue vlink=purple style='tab-interval:36.0pt'>

<div class=Section1>

<h1 align=center style='text-align:center'><span lang=EN-GB>In The Toolbox –
Wrapper Scripts</span></h1>

<p class=MsoNormal><span lang=EN-GB><o:p>&nbsp;</o:p></span></p>

<p class=MsoNormal><span lang=EN-GB>At the ACCU conference this year <st1:PersonName
w:st="on">Pete Goodliffe</st1:PersonName> hosted a session titled “Becoming a
Better Programmer”. Part of it involved a number of people (that Pete had
invited) spending a few minutes describing what they believe has helped make
them a better programmer. One such person was the editor of this very journal –
<st1:PersonName w:st="on">Steve Love</st1:PersonName> – who picked Automation
as his topic. If you read his editorial from a few issues back you’ll know
that, like Pete and Steve, I too prefer to simplify things when I find myself
doing the same task over and over. The full subjects of both automation and
scripting are huge in themselves, but there is a particular intersection that
at first might seem almost trivial and yet can quickly grow into something more
useful – wrapper scripts.</span></p>

<h3><span lang=EN-GB>Simplifying Existing Tools</span></h3>

<p class=MsoNormal><span lang=EN-GB>If you’ve ever worked with SQL Server from
the command line you’ll have come across the bundled </span><code><span
lang=EN-GB style='font-size:10.0pt'>SQLCMD.EXE</span></code><span lang=EN-GB>
tool. This, along with its forerunner </span><code><span lang=EN-GB
style='font-size:10.0pt'>OSQL.EXE</span></code><span lang=EN-GB>, is the
traditional <span class=GramE>tool</span> for executing SQL statements (and
script files) against a SQL Server instance. Like many mature command line
tools it’s a bit of a Swiss-Army knife and has sprouted a myriad of options and
switches to control how you feed SQL text into it and how the results and
errors are handled after execution. For example the following command will
fetch the current time on a local instance using the current user credentials:-</span></p>

<p class=MsoNormal><span lang=EN-GB><o:p>&nbsp;</o:p></span></p>

<p class=MsoNormal><span class=GramE><code><span lang=EN-GB style='font-size:
10.0pt'>C:</span></code></span><code><span lang=EN-GB style='font-size:10.0pt'>\&gt;
SQLCMD –E –S .\SQLEXPRESS –d master–b –m 10 –Q “select <span class=SpellE>getdate</span>();”<o:p></o:p></span></code></p>

<p class=MsoNormal><span lang=EN-GB><o:p>&nbsp;</o:p></span></p>

<p class=MsoNormal><span lang=EN-GB>The </span><code><span lang=EN-GB
style='font-size:10.0pt'>–b</span></code><span lang=EN-GB> and </span><code><span
lang=EN-GB style='font-size:10.0pt'>–m</span></code><span lang=EN-GB> switches
are technically unnecessary when running interactively, but the moment you
start running SQL batches from scripts you’ll likely add them if you want
anything out of the ordinary to cause execution to stop and </span><code><span
lang=EN-GB style='font-size:10.0pt'>SQLCMD</span></code><span lang=EN-GB> to
return an error code. Then there is the annoyance factor of just getting the
command line slightly wrong. If you forget the </span><code><span lang=EN-GB
style='font-size:10.0pt'>–E</span></code><span lang=EN-GB> you’ll get a weird
login failure, or if you use </span><code><span lang=EN-GB style='font-size:
10.0pt'>–q</span></code><span lang=EN-GB> instead of </span><code><span
lang=EN-GB style='font-size:10.0pt'>–Q</span></code><span lang=EN-GB> it won’t
terminate after executing the SQL. Case-sensitive command line tools do nothing
to help ensure a calm, quiet working environment either.</span></p>

<p class=MsoNormal><span lang=EN-GB><o:p>&nbsp;</o:p></span></p>

<p class=MsoNormal><span lang=EN-GB>One tried and trusted solution to these “problems”
is to turn to the venerable Wiki and document lots of command lines as snippets
that you can just cut-and-paste directly into your shell. Anyone who has ever
tried that from a Word document where Word has been “smart” and converted the
simple dashes to “smart” dashes will know how fraught with danger this idea is.
That’s before you consider what happens when the wiki becomes unavailable (and
I can guarantee a development server has an <st1:place w:st="on">SLA</st1:place>
measured in months) or you begin to appreciate the shear tediousness of what it
is you’re actually doing.</span></p>

<p class=MsoNormal><span lang=EN-GB><o:p>&nbsp;</o:p></span></p>

<p class=MsoNormal><span lang=EN-GB>Another more personal alternative is to use
your shell or some 3<sup>rd</sup> party tool to create little macros for your
favourite commands. However, I feel this is a bit like writing your own tests –
if it’s good enough for you, then why not the rest of the team? After all, when
a new team member joins they’re probably going to have to go through the same
process. So, you can give them a leg-up by storing a set of project-specific
pre-canned scripts that helps with the most common scenarios.</span></p>

<p class=MsoNormal><span lang=EN-GB><o:p>&nbsp;</o:p></span></p>

<p class=MsoNormal><span lang=EN-GB>In a sense it’s a bit like Partial Function
Application because, whereas a tool like </span><code><span lang=EN-GB
style='font-size:10.0pt'>SQLCMD</span></code><span lang=EN-GB> has to allow for
the different modes of operation in general, your development environment will almost
certainly be far more specific. This means you can exploit that knowledge by
first cutting down on any superfluous arguments. The command below, for
example, creates a new database on a local instance:-</span></p>

<p class=MsoNormal><span lang=EN-GB><o:p>&nbsp;</o:p></span></p>

<p class=MsoNormal><span class=GramE><code><span lang=EN-GB style='font-size:
10.0pt'>C:</span></code></span><code><span lang=EN-GB style='font-size:10.0pt'>\&gt;
SQLCMD –E –S .\SQLEXPRESS –d master –Q “create database <span class=SpellE>MyTestDb</span>;”<o:p></o:p></span></code></p>

<p class=MsoNormal><span lang=EN-GB><o:p>&nbsp;</o:p></span></p>

<p class=MsoNormal><span lang=EN-GB>The only two real variables in the command
are the instance (.\SQLEXPRESS) and the database name (<span class=SpellE>MyTestDb</span>),
the rest is boilerplate stuff. So, let’s create a batch file that accepts just
those two parameters, and more importantly has a memorable name (</span><span
class=SpellE><code><span lang=EN-GB style='font-size:10.0pt'>CreateDatabase.cmd</span></code></span><span
lang=EN-GB>):-</span></p>

<p class=MsoNormal><span lang=EN-GB><o:p>&nbsp;</o:p></span></p>

<p class=MsoNormal><code><span lang=EN-GB style='font-size:10.0pt'>@SQLCMD –E
–S %1 –d master –Q “create database %2;”<o:p></o:p></span></code></p>

<p class=MsoNormal><span lang=EN-GB><o:p>&nbsp;</o:p></span></p>

<p class=MsoNormal><span lang=EN-GB>Now we can just use this simple script to
create a test database in future:-</span></p>

<p class=MsoNormal><span lang=EN-GB><o:p>&nbsp;</o:p></span></p>

<p class=MsoNormal><span class=GramE><code><span lang=EN-GB style='font-size:
10.0pt'>C:</span></code></span><code><span lang=EN-GB style='font-size:10.0pt'>\&gt;
<span class=SpellE>CreateDatabase</span> .\SQLEXPRESS <span class=SpellE>MyTestDb</span><o:p></o:p></span></code></p>

<h3><span lang=EN-GB>Error Handling</span></h3>

<p class=MsoNormal><span lang=EN-GB>Of course just like any other code we write
we have to consider the handling of errors and so we should add a sprinkling of
that too – first to check we have the required number of arguments, then to
pass back any error returned by the actual tool:-</span></p>

<p class=MsoNormal><span lang=EN-GB><o:p>&nbsp;</o:p></span></p>

<p class=MsoNormal><code><span lang=EN-GB style='font-size:10.0pt'>@echo off<o:p></o:p></span></code></p>

<p class=MsoNormal><span class=GramE><code><span lang=EN-GB style='font-size:
10.0pt'>if</span></code></span><code><span lang=EN-GB style='font-size:10.0pt'>
/<span class=SpellE>i</span> &quot;%1&quot; == &quot;&quot; call :usage &amp;
exit /b 1<o:p></o:p></span></code></p>

<p class=MsoNormal><span class=GramE><code><span lang=EN-GB style='font-size:
10.0pt'>if</span></code></span><code><span lang=EN-GB style='font-size:10.0pt'>
/<span class=SpellE>i</span> &quot;%2&quot; == &quot;&quot; call :usage &amp;
exit /b 1<o:p></o:p></span></code></p>

<p class=MsoNormal><code><span lang=EN-GB style='font-size:10.0pt'><o:p>&nbsp;</o:p></span></code></p>

<p class=MsoNormal><code><span lang=EN-GB style='font-size:10.0pt'>SQLCMD –E –S
%1 –d master –Q “create database %2;”<o:p></o:p></span></code></p>

<p class=MsoNormal><span class=GramE><code><span lang=EN-GB style='font-size:
10.0pt'>if</span></code></span><code><span lang=EN-GB style='font-size:10.0pt'>
<span class=SpellE>errorlevel</span> 1 exit /b %<span class=SpellE>errorlevel</span>%<o:p></o:p></span></code></p>

<p class=MsoNormal><code><span lang=EN-GB style='font-size:10.0pt'><o:p>&nbsp;</o:p></span></code></p>

<p class=MsoNormal><span class=GramE><code><span lang=EN-GB style='font-size:
10.0pt'>:usage</span></code></span><code><span lang=EN-GB style='font-size:
10.0pt'><o:p></o:p></span></code></p>

<p class=MsoNormal><span class=GramE><code><span lang=EN-GB style='font-size:
10.0pt'>echo</span></code></span><code><span lang=EN-GB style='font-size:10.0pt'>
Usage: %~n0 ^&lt;instance^&gt; ^&lt;database^&gt;<o:p></o:p></span></code></p>

<p class=MsoNormal><span class=SpellE><span class=GramE><code><span lang=EN-GB
style='font-size:10.0pt'>goto</span></code></span></span><code><span
lang=EN-GB style='font-size:10.0pt'> :<span class=SpellE>eof</span><o:p></o:p></span></code></p>

<p class=MsoNormal><span lang=EN-GB><o:p>&nbsp;</o:p></span></p>

<p class=MsoNormal><span lang=EN-GB>If you have bothered to write a usage
message, then you could also choose to add a couple of extra lines to provide a
consistent and modern way to query it (although this somewhat starts to defeat
the original purpose of the exercise – simplification!):-</span></p>

<p class=MsoNormal><span lang=EN-GB><o:p>&nbsp;</o:p></span></p>

<p class=MsoNormal><span class=GramE><code><span lang=EN-GB style='font-size:
10.0pt'>if</span></code></span><code><span lang=EN-GB style='font-size:10.0pt'>
/<span class=SpellE>i</span> &quot;%1&quot; == &quot;-?&quot;<span
style='mso-spacerun:yes'>     </span><span class=GramE>call</span> :usage &amp;
exit /b 0<o:p></o:p></span></code></p>

<p class=MsoNormal><span class=GramE><code><span lang=EN-GB style='font-size:
10.0pt'>if</span></code></span><code><span lang=EN-GB style='font-size:10.0pt'>
/<span class=SpellE>i</span> &quot;%1&quot; == &quot;--help&quot; call :usage
&amp; exit /b 0<o:p></o:p></span></code></p>

<p class=MsoNormal><span lang=EN-GB><o:p>&nbsp;</o:p></span></p>

<p class=MsoNormal><span lang=EN-GB>Now, at this point I’m sure you’re
beginning to question whether the script is starting to get so complicated that
you’ll be spending more time writing it than what you (and hopefully your
colleagues) will eventually save by using it. To decide that I suggest you
consult the recent XKCD titled “Is It <span class=GramE>Worth</span> the Time?”
[1].</span></p>

<p class=MsoNormal><span lang=EN-GB><o:p>&nbsp;</o:p></span></p>

<p class=MsoNormal><span lang=EN-GB>However it should also be fairly obvious
that this is just boilerplate code that can be copied from a template. One such
template (for batch files) can be found in my blog post “Windows Batch File
Template” [2]. Consequently I’ve found putting these kind of scripts together quite
trivial and it also allows for some other common simple scenarios to be easily
accommodated.</span></p>

<h3><span lang=EN-GB>Personalisation</span></h3>

<p class=MsoNormal><span lang=EN-GB>As a rule of thumb the point of these sorts
of scripts is to allow a more unified development experience through the use of
some common tools. Also the development environment should allow for the
redundancy to be hidden or removed as we saw above. But there are times when
each developer (and the build machine itself counts as another developer) needs
to provide some personal configuration data.</span></p>

<p class=MsoNormal><span lang=EN-GB><o:p>&nbsp;</o:p></span></p>

<p class=MsoNormal><span lang=EN-GB>Once again the database example fits the
bill nicely. In many organisations you can install a database locally, but not
everywhere allows this (you can thank an overreaction to the 2003 Slammer virus
for that). Although not ideal, you may also have to deal with minor differences
in development machine configuration such as where the instance is installed (a
fresh install and an upgrade can be different). For example nearly every
developer may have a local copy of SQL Server Express and be quite happy
calling their unit test database “<span class=SpellE>UnitTest</span>”, in which
case you might as well save them a bit more typing and just default to those
values:-</span></p>

<p class=MsoNormal><span lang=EN-GB><o:p>&nbsp;</o:p></span></p>

<p class=MsoNormal><span class=GramE><code><span lang=EN-GB style='font-size:
10.0pt'>set</span></code></span><code><span lang=EN-GB style='font-size:10.0pt'>
instance=%1<o:p></o:p></span></code></p>

<p class=MsoNormal><span class=GramE><code><span lang=EN-GB style='font-size:
10.0pt'>set</span></code></span><code><span lang=EN-GB style='font-size:10.0pt'>
database=%2<o:p></o:p></span></code></p>

<p class=MsoNormal><code><span lang=EN-GB style='font-size:10.0pt'><o:p>&nbsp;</o:p></span></code></p>

<p class=MsoNormal><span class=GramE><code><span lang=EN-GB style='font-size:
10.0pt'>if</span></code></span><code><span lang=EN-GB style='font-size:10.0pt'>
/<span class=SpellE>i</span> “%instance%” == “” set instance=.\SQLEXPRESS<o:p></o:p></span></code></p>

<p class=MsoNormal><span class=GramE><code><span lang=EN-GB style='font-size:
10.0pt'>if</span></code></span><code><span lang=EN-GB style='font-size:10.0pt'>
/<span class=SpellE>i</span> “%database%” == “” set database=<span
class=SpellE>UnitTest</span><o:p></o:p></span></code></p>

<p class=MsoNormal><span lang=EN-GB><o:p>&nbsp;</o:p></span></p>

<p class=MsoNormal><span lang=EN-GB>An alternative approach is to use optional
environment variables to specify the default values so that you never need to
pas any arguments if you decide to tow the party line:-</span></p>

<p class=MsoNormal><span lang=EN-GB><o:p>&nbsp;</o:p></span></p>

<p class=MsoNormal><span class=GramE><code><span lang=EN-GB style='font-size:
10.0pt'>set</span></code></span><code><span lang=EN-GB style='font-size:10.0pt'>
instance=%<span class=SpellE>personal_instance</span>%<o:p></o:p></span></code></p>

<p class=MsoNormal><span class=GramE><code><span lang=EN-GB style='font-size:
10.0pt'>set</span></code></span><code><span lang=EN-GB style='font-size:10.0pt'>
database=%<span class=SpellE>personal_database</span>%<o:p></o:p></span></code></p>

<p class=MsoNormal><code><span lang=EN-GB style='font-size:10.0pt'><o:p>&nbsp;</o:p></span></code></p>

<p class=MsoNormal><span class=GramE><code><span lang=EN-GB style='font-size:
10.0pt'>if</span></code></span><code><span lang=EN-GB style='font-size:10.0pt'>
/<span class=SpellE>i</span> “%instance%” == “” set instance=%1<o:p></o:p></span></code></p>

<p class=MsoNormal><span class=GramE><code><span lang=EN-GB style='font-size:
10.0pt'>if</span></code></span><code><span lang=EN-GB style='font-size:10.0pt'>
/<span class=SpellE>i</span> “%database%” == “” set database=%2<o:p></o:p></span></code></p>

<p class=MsoNormal><code><span lang=EN-GB style='font-size:10.0pt'><o:p>&nbsp;</o:p></span></code></p>

<p class=MsoNormal><span class=GramE><code><span lang=EN-GB style='font-size:
10.0pt'>if</span></code></span><code><span lang=EN-GB style='font-size:10.0pt'>
/<span class=SpellE>i</span> “%instance%” == “” call :usage &amp; exit /b 0<o:p></o:p></span></code></p>

<p class=MsoNormal><span class=GramE><code><span lang=EN-GB style='font-size:
10.0pt'>if</span></code></span><code><span lang=EN-GB style='font-size:10.0pt'>
/<span class=SpellE>i</span> “%database%” == “” call :usage &amp; exit /b 0<o:p></o:p></span></code></p>

<p class=MsoNormal><span lang=EN-GB><o:p>&nbsp;</o:p></span></p>

<p class=MsoNormal><span lang=EN-GB>Ultimate flexibility comes from combining
the two approaches so that you can keep things really simple for the vast
majority of use cases, but you still have the ability to override things at any
point by supplying different values on the command line. In my experience
database development is the one place where this has actually proved to be quite
useful.</span></p>

<h3><span lang=EN-GB>Developer Sandbox Set-up</span></h3>

<p class=MsoNormal><span lang=EN-GB>If you’re going to allow (or need to
accommodate) some element of personalised configuration then make sure it is
optional. There is nothing more soul-destroying on your first day of a new job
than being presented with a 30-page manual on what steps you need to take to
configure your development machine so that you can actually do your job. And if
you think I’m exaggerating by recounting a 30-page document – I’m not!</span></p>

<p class=MsoNormal><span lang=EN-GB><o:p>&nbsp;</o:p></span></p>

<p class=MsoNormal><span lang=EN-GB>For me the steps required to get up and
running on a new project should be as simple as:-</span></p>

<p class=MsoNormal><span lang=EN-GB><o:p>&nbsp;</o:p></span></p>

<ol style='margin-top:0cm' start=1 type=1>
 <li class=MsoNormal style='mso-list:l0 level1 lfo1;tab-stops:list 36.0pt'><span
     lang=EN-GB>Install version control software</span></li>
 <li class=MsoNormal style='mso-list:l0 level1 lfo1;tab-stops:list 36.0pt'><span
     lang=EN-GB>Fetch development branch codebase</span></li>
 <li class=MsoNormal style='mso-list:l0 level1 lfo1;tab-stops:list 36.0pt'><span
     lang=EN-GB>Build code &amp; run tests</span></li>
</ol>

<p class=MsoNormal style='margin-left:18.0pt'><span lang=EN-GB><o:p>&nbsp;</o:p></span></p>

<p class=MsoNormal><span lang=EN-GB>Step 3 might look like it should be split
into two, but it’s not because that’s exactly what the build machine will be
doing and so whatever <i style='mso-bidi-font-style:normal'>it</i> does I
should be able to, too. At this point I then know that I can replicate what the
build machine does and so I’m good to go.</span></p>

<h3><span lang=EN-GB>Script Composition</span></h3>

<p class=MsoNormal><span lang=EN-GB>After you’ve created a few simple scripts
it then becomes easier to see how you can combine them with other simple
scripts to accomplish ever bigger tasks. Although it was never envisaged it
would end up that way much of the build processes I’ve been involved with in
the past few years have ended up taking an imperative approach mainly due to
the incremental approach of layering together many simple scripts to create a
more complex process. The same goes for the deployment side as well.</span></p>

<p class=MsoNormal><span lang=EN-GB><o:p>&nbsp;</o:p></span></p>

<p class=MsoNormal><span lang=EN-GB>For example the deployment process started
out as two simple scripts that wrapped invoking </span><code><span lang=EN-GB
style='font-size:10.0pt'>MSIEXEC.EXE</span></code><span lang=EN-GB> – one to
install the package and one to uninstall it. The wrappers allowed me to handle
the common error codes (e.g. 1605) that occur when the package is already <span
class=GramE>installed/uninstalled</span>. Once the NT services were written
another simple wrapper around </span><code><span lang=EN-GB style='font-size:
10.0pt'>SC.EXE</span></code><span lang=EN-GB> was created to start/stop them.
These where then combined into a larger script that ensured the services were
started/stopped before/after the packages installed/uninstalled. Add in another
simple script to ensure any errant processes are terminated (</span><code><span
lang=EN-GB style='font-size:10.0pt'>PSKILL.EXE</span></code><span lang=EN-GB>),
another to copy the files from a known share to the local machine (</span><code><span
lang=EN-GB style='font-size:10.0pt'>ROBOCOPY.EXE</span></code><span lang=EN-GB>)
and finally a top-level script to act as the root for a Scheduled Task and you
suddenly have an automated deployment process that even Heath Robinson would be
proud of.</span></p>

<h3><span lang=EN-GB>Scripting Objects</span></h3>

<p class=MsoNormal><span lang=EN-GB>On Windows there is a slight variation on
this theme of driving command line tools using a very basic language; which is
to drive “objects” instead. If you consider the batch file language as the glue
that binds together disparate console-style processes, then VBScript is the
same simple glue that binds together objects exposed via COM. It might seem an
expensive way to do business, but if your architecture is that classic pairing
of a Visual Basic front-end and a C++ back-end then you’ve already done most of
the heavy lifting. It might sound perverse but I’ve worked on a project where
the entire build process was a library of VBScript files that were stitched
together by using Windows Script Host (.WSF) files. It’s not something a sane
person would consider doing today but 10-15 years ago it was Microsoft’s answer
to the lack of scripting on Windows. That said, in a locked down production
environment with legacy servers it might still be your only choice.</span></p>

<p class=MsoNormal><span lang=EN-GB><o:p>&nbsp;</o:p></span></p>

<p class=MsoNormal><span lang=EN-GB>In a way that ideology still exists today
in the guise of PowerShell. COM has been replaced by its modern heir - .Net - and
the PowerShell language provides a much cleaner binding because .Net itself
underpins it. Of course the pipeline model still exists too although it’s been
“enhanced” to flow objects instead of simple lines of text. Once again, if your
core technology is already .Net you’ve done the heavy lifting and consuming
your components via scripts is pretty easy. PowerShell may be Microsoft’s first
choice, but the model works equally well with both F# and <span class=SpellE>IronPython</span>
in the driving seat, although the latter seems to be sorely neglected these
days.</span></p>

<h3><span lang=EN-GB>Capturing Pipelines</span></h3>

<p class=MsoNormal><span lang=EN-GB>Of course none of this is going to replace
the venerable UNIX pipeline which, despite its simple text based nature, lives
on exactly because it’s simple and an army of programmers have created a wealth
of small, well-focused tools that are designed to be composed to create
something bigger than the sum of its parts.</span></p>

<p class=MsoNormal><span lang=EN-GB><o:p>&nbsp;</o:p></span></p>

<p class=MsoNormal><span lang=EN-GB>Oftentimes I’ll need to do a little text processing
and it ends up being a disposable one-liner. But other times I realise it
actually might be useful to my team mates. There is a certain level of personal
gratification in publishing your Byzantine one-liners to your fellow developers
and if they only see the light of day once in a blue moon then the XKCD chart [1]
rules. But if you think it’ll get a frequent work out then you might want to
consider encapsulating it within a script for ease of use.</span></p>

<p class=MsoNormal><span lang=EN-GB><o:p>&nbsp;</o:p></span></p>

<p class=MsoNormal><span lang=EN-GB>A few years ago I started work on a new
project that sprouted the need to process line-based text files at every turn.
This caused me to reacquaint myself with </span><code><span lang=EN-GB
style='font-size:10.0pt'>SED</span></code><span lang=EN-GB> &amp; </span><st1:stockticker
w:st="on"><code><span lang=EN-GB style='font-size:10.0pt'>AWK</span></code></st1:stockticker><span
lang=EN-GB> as part of a rediscovery of the classic pipeline. In fact you’ll
find my delight documented in this very journal as part of the Inspirational (P<span
class=GramE>)articles</span> series [3].</span></p>

<p class=MsoNormal><span lang=EN-GB><o:p>&nbsp;</o:p></span></p>

<p class=MsoNormal><span lang=EN-GB>In one particular case after the system had
gone live I started needing to compare some published <st1:stockticker w:st="on">CSV</st1:stockticker>
files between the <span class=GramE>development</span>, test and production
environments as part of the testing strategy. The files were not directly
comparable so a little pre-processing was needed to first remove the noise. Old
hands will no doubt recognise that a sprinkling of </span><code><span
lang=EN-GB style='font-size:10.0pt'>SED</span></code><span lang=EN-GB> is one
way to replace some variable string patterns with fixed (and therefore
comparable) text:-</span></p>

<p class=MsoNormal><span lang=EN-GB><o:p>&nbsp;</o:p></span></p>

<p class=MsoNormal><code><span lang=EN-GB style='font-size:10.0pt'>SED
“s/Timed-Out/ERROR/g” | SED “s/<span class=SpellE>OutOfMemory</span>/ERROR/g”<o:p></o:p></span></code></p>

<p class=MsoNormal><span lang=EN-GB><o:p>&nbsp;</o:p></span></p>

<p class=MsoNormal><span lang=EN-GB>Due to the non-deterministic nature of a SQL
</span><code><span lang=EN-GB style='font-size:10.0pt'>SELECT</span></code><span
lang=EN-GB> without an </span><code><span lang=EN-GB style='font-size:10.0pt'>ORDER
BY</span></code><span lang=EN-GB> clause (which would have been an unnecessary
burden on SQL Server) the file needed to be sorted. The best key to sort on was
not the leftmost in the file which meant treating the file as having delimited
fields:-</span></p>

<p class=MsoNormal><span lang=EN-GB><o:p>&nbsp;</o:p></span></p>

<p class=MsoNormal><st1:stockticker w:st="on"><code><span lang=EN-GB
 style='font-size:10.0pt'>SORT</span></code></st1:stockticker><code><span
lang=EN-GB style='font-size:10.0pt'> –t “|” –k 3<span class=GramE>,4</span><o:p></o:p></span></code></p>

<p class=MsoNormal><span lang=EN-GB><o:p>&nbsp;</o:p></span></p>

<p class=MsoNormal><span lang=EN-GB>Finally, every time the file had new fields
appended in a release they needed to be ignored when doing regression testing:-</span></p>

<p class=MsoNormal><span lang=EN-GB><o:p>&nbsp;</o:p></span></p>

<p class=MsoNormal><code><span lang=EN-GB style='font-size:10.0pt'>CUT –d “|”
–f 1-24<o:p></o:p></span></code></p>

<p class=MsoNormal><span lang=EN-GB><o:p>&nbsp;</o:p></span></p>

<p class=MsoNormal><span lang=EN-GB>The output was always fed directly to a GUI
based diff tool in case there were differences to investigate and so structurally
the script looked like this:-</span></p>

<p class=MsoNormal><span lang=EN-GB><o:p>&nbsp;</o:p></span></p>

<p class=MsoNormal><code><span lang=EN-GB style='font-size:10.0pt'>SED %1 … |
SED … | SED … | <st1:stockticker w:st="on">SORT</st1:stockticker> … | CUT …
&gt; “%TEMP%\<span class=SpellE>lhs.csv</span>”<o:p></o:p></span></code></p>

<p class=MsoNormal><code><span lang=EN-GB style='font-size:10.0pt'>SED %2 … |
SED … | SED … | <st1:stockticker w:st="on">SORT</st1:stockticker> … | CUT …
&gt; “%TEMP%\<span class=SpellE>rhs.csv</span>”<o:p></o:p></span></code></p>

<p class=MsoNormal><code><span lang=EN-GB style='font-size:10.0pt'>GUIDIFF
“%TEMP%\<span class=SpellE>lhs.csv</span>” “%TEMP%\<span class=SpellE>rhs.csv</span>”<o:p></o:p></span></code></p>

<p class=MsoNormal><span lang=EN-GB><o:p>&nbsp;</o:p></span></p>

<p class=MsoNormal><span lang=EN-GB>There was no reason (apart from the usual
lack of time and a suitably privileged account) why that last step couldn’t
have used the normal </span><code><span lang=EN-GB style='font-size:10.0pt'>DIFF</span></code><span
lang=EN-GB> tool and been automated to capture the differences in a report every
morning.</span></p>

<p class=MsoNormal><span lang=EN-GB><o:p>&nbsp;</o:p></span></p>

<p class=MsoNormal><span lang=EN-GB>Gall’s Law [4] says that a complex system
that works is invariably found to have evolved from a simple system that
worked. Build, test and deployment processes in particular seem to have a habit
of growing organically and judicious use of little scripts can be one way of
slowly piecing together functionality by building on the existing set of tried
and trusted tools.</span></p>

<p class=MsoNormal><span lang=EN-GB><o:p>&nbsp;</o:p></span></p>

<p class=MsoNormal><span lang=EN-GB>[1] <a href="http://xkcd.com/1205">http://xkcd.com/1205</a></span></p>

<p class=MsoNormal><span lang=EN-GB>[2] <a
href="http://chrisoldwood.blogspot.co.uk/2010/06/windows-batch-file-template.html">http://chrisoldwood.blogspot.co.uk/2010/06/windows-batch-file-template.html</a></span></p>

<p class=MsoNormal><span lang=EN-GB>[3] C Vu Journal <span class=SpellE>Vol</span>
23 #1 (March 2011) &amp; <a
href="http://chrisoldwood.blogspot.co.uk/2010/11/reacquainting-myself-with-sed-awk.html">http://chrisoldwood.blogspot.co.uk/2010/11/reacquainting-myself-with-sed-awk.html</a></span></p>

<p class=MsoNormal><span lang=EN-GB>[4] <a
href="http://en.wikipedia.org/wiki/Gall's_law">http://en.wikipedia.org/wiki/Gall's_law</a></span></p>

<p class=MsoNormal><span lang=EN-GB><o:p>&nbsp;</o:p></span></p>

<p class=MsoNormal><span lang=EN-GB>Chris Oldwood</span></p>

<p class=MsoNormal><!--[if supportFields]><span lang=EN-GB><span
style='mso-element:field-begin'></span><span
style='mso-spacerun:yes'> </span>SAVEDATE<span style='mso-spacerun:yes'> 
</span>\@ &quot;dd MMMM yyyy&quot;<span style='mso-spacerun:yes'>  </span>\*
MERGEFORMAT <span style='mso-element:field-separator'></span></span><![endif]--><span
lang=EN-GB><span style='mso-no-proof:yes'>13 June 2013</span></span><!--[if supportFields]><span
lang=EN-GB><span style='mso-element:field-end'></span></span><![endif]--></p>

<p class=MsoNormal><span lang=EN-GB><o:p>&nbsp;</o:p></span></p>

<p class=MsoNormal><u><span lang=EN-GB>Bio<o:p></o:p></span></u></p>

<p class=MsoNormal><span lang=EN-GB>Chris is a freelance developer who started
out as a bedroom coder in the 80’s writing assembler on 8-bit micros. These
days it’s C++ and C# on Windows in big plush corporate offices. He is also the
commentator for the Godmanchester Gala Day Duck Race and can be contacted via <a
href="mailto:gort@cix.co.uk">gort@cix.co.uk</a> or @<span class=SpellE>chrisoldwood</span>.</span></p>

<p class=MsoNormal><span lang=EN-GB><o:p>&nbsp;</o:p></span></p>

</div>

</body>

</html>
