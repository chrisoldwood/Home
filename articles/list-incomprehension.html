<html xmlns:o="urn:schemas-microsoft-com:office:office"
xmlns:w="urn:schemas-microsoft-com:office:word"
xmlns:st1="urn:schemas-microsoft-com:office:smarttags"
xmlns="http://www.w3.org/TR/REC-html40">

<head>
<meta http-equiv=Content-Type content="text/html; charset=windows-1252">
<meta name=ProgId content=Word.Document>
<meta name=Generator content="Microsoft Word 11">
<meta name=Originator content="Microsoft Word 11">
<link rel=File-List href="List%20Incomprehension_files/filelist.xml">
<title>List Incomprehension</title>
<o:SmartTagType namespaceuri="urn:schemas-microsoft-com:office:smarttags"
 name="stockticker"/>
<o:SmartTagType namespaceuri="urn:schemas-microsoft-com:office:smarttags"
 name="place"/>
<o:SmartTagType namespaceuri="urn:schemas-microsoft-com:office:smarttags"
 name="City"/>
<o:SmartTagType namespaceuri="urn:schemas-microsoft-com:office:smarttags"
 name="PersonName"/>
<!--[if gte mso 9]><xml>
 <o:DocumentProperties>
  <o:Author>Chris Oldwood</o:Author>
  <o:LastAuthor>Chris Oldwood</o:LastAuthor>
  <o:Revision>2</o:Revision>
  <o:TotalTime>1394</o:TotalTime>
  <o:Created>2014-05-05T19:27:00Z</o:Created>
  <o:LastSaved>2014-05-05T19:27:00Z</o:LastSaved>
  <o:Pages>1</o:Pages>
  <o:Words>1074</o:Words>
  <o:Characters>6125</o:Characters>
  <o:Company>Co Productions Ltd</o:Company>
  <o:Lines>51</o:Lines>
  <o:Paragraphs>14</o:Paragraphs>
  <o:CharactersWithSpaces>7185</o:CharactersWithSpaces>
  <o:Version>11.9999</o:Version>
 </o:DocumentProperties>
</xml><![endif]--><!--[if gte mso 9]><xml>
 <w:WordDocument>
  <w:GrammarState>Clean</w:GrammarState>
  <w:ValidateAgainstSchemas/>
  <w:SaveIfXMLInvalid>false</w:SaveIfXMLInvalid>
  <w:IgnoreMixedContent>false</w:IgnoreMixedContent>
  <w:AlwaysShowPlaceholderText>false</w:AlwaysShowPlaceholderText>
  <w:Compatibility>
   <w:BreakWrappedTables/>
   <w:SnapToGridInCell/>
   <w:WrapTextWithPunct/>
   <w:UseAsianBreakRules/>
   <w:UseWord2002TableStyleRules/>
  </w:Compatibility>
  <w:BrowserLevel>MicrosoftInternetExplorer4</w:BrowserLevel>
 </w:WordDocument>
</xml><![endif]--><!--[if gte mso 9]><xml>
 <w:LatentStyles DefLockedState="false" LatentStyleCount="156">
 </w:LatentStyles>
</xml><![endif]--><!--[if !mso]><object
 classid="clsid:38481807-CA0E-42D2-BF39-B33AF135CC4D" id=ieooui></object>
<style>
st1\:*{behavior:url(#ieooui) }
</style>
<![endif]-->
<style>
<!--
 /* Style Definitions */
 p.MsoNormal, li.MsoNormal, div.MsoNormal
	{mso-style-parent:"";
	margin:0cm;
	margin-bottom:.0001pt;
	mso-pagination:widow-orphan;
	font-size:12.0pt;
	font-family:"Times New Roman";
	mso-fareast-font-family:"Times New Roman";
	mso-ansi-language:EN-GB;}
h1
	{mso-style-next:Normal;
	margin-top:12.0pt;
	margin-right:0cm;
	margin-bottom:3.0pt;
	margin-left:0cm;
	mso-pagination:widow-orphan;
	page-break-after:avoid;
	mso-outline-level:1;
	font-size:16.0pt;
	font-family:Arial;
	mso-font-kerning:16.0pt;
	mso-ansi-language:EN-GB;}
h3
	{mso-style-next:Normal;
	margin-top:12.0pt;
	margin-right:0cm;
	margin-bottom:3.0pt;
	margin-left:0cm;
	mso-pagination:widow-orphan;
	page-break-after:avoid;
	mso-outline-level:3;
	font-size:13.0pt;
	font-family:Arial;
	mso-ansi-language:EN-GB;}
a:link, span.MsoHyperlink
	{color:blue;
	text-decoration:underline;
	text-underline:single;}
a:visited, span.MsoHyperlinkFollowed
	{color:purple;
	text-decoration:underline;
	text-underline:single;}
code
	{font-family:"Courier New";
	mso-ascii-font-family:"Courier New";
	mso-fareast-font-family:"Times New Roman";
	mso-hansi-font-family:"Courier New";
	mso-bidi-font-family:"Courier New";}
span.GramE
	{mso-style-name:"";
	mso-gram-e:yes;}
@page Section1
	{size:612.0pt 792.0pt;
	margin:72.0pt 90.0pt 72.0pt 90.0pt;
	mso-header-margin:35.4pt;
	mso-footer-margin:35.4pt;
	mso-paper-source:0;}
div.Section1
	{page:Section1;}
-->
</style>
<!--[if gte mso 10]>
<style>
 /* Style Definitions */
 table.MsoNormalTable
	{mso-style-name:"Table Normal";
	mso-tstyle-rowband-size:0;
	mso-tstyle-colband-size:0;
	mso-style-noshow:yes;
	mso-style-parent:"";
	mso-padding-alt:0cm 5.4pt 0cm 5.4pt;
	mso-para-margin:0cm;
	mso-para-margin-bottom:.0001pt;
	mso-pagination:widow-orphan;
	font-size:10.0pt;
	font-family:"Times New Roman";
	mso-ansi-language:#0400;
	mso-fareast-language:#0400;
	mso-bidi-language:#0400;}
</style>
<![endif]-->
</head>

<body lang=EN-US link=blue vlink=purple style='tab-interval:36.0pt'>

<div class=Section1>

<h1 align=center style='text-align:center'><span lang=EN-GB>List Incomprehension</span></h1>

<p class=MsoNormal><span lang=EN-GB><o:p>&nbsp;</o:p></span></p>

<p class=MsoNormal><span lang=EN-GB>I’ve never really got on very well with the
“list” data type. Back when I started programming professionally I was writing
code in C and we had to create many of the basic data types ourselves.
Generally speaking, at the time, if you needed a variable sized collection you
opted for a linked-list, and usually a doubley-linked list at that. This gave
you more flexibility when it came to traversing, and also the same underlying structure
could be used for a Stack or Queue depending on whether you needed to add or remove
from the head or tail.</span></p>

<p class=MsoNormal><span lang=EN-GB><o:p>&nbsp;</o:p></span></p>

<p class=MsoNormal><span lang=EN-GB>As a consequence I grew up for many years
believing a list always had a head, a body and a tail; where the head and tail
were a single item at the front and back respectively and the body was all the
elements in between. The side-effect of this distorted mental model was a great
difficulty [1] understanding the concept of Typelists when Andrei Alexandrescu
published his seminal work Modern C++ Design.</span></p>

<p class=MsoNormal><span lang=EN-GB><o:p>&nbsp;</o:p></span></p>

<p class=MsoNormal><span lang=EN-GB>I lay some of the blame for my early programming
ills firmly at the door of <st1:stockticker w:st="on">MFC</st1:stockticker>.
The following snippet shows what <st1:stockticker w:st="on">MFC</st1:stockticker>’s
idea of a list class does (of course it also reinforces my own already misguided
belief of what a list was at that point too):-</span></p>

<p class=MsoNormal><span lang=EN-GB><o:p>&nbsp;</o:p></span></p>

<p class=MsoNormal><code><span lang=EN-GB style='font-size:10.0pt'>CList list;<o:p></o:p></span></code></p>

<p class=MsoNormal><code><span lang=EN-GB style='font-size:10.0pt'><o:p>&nbsp;</o:p></span></code></p>

<p class=MsoNormal><span class=GramE><code><span lang=EN-GB style='font-size:
10.0pt'>list.AddHead(</span></code></span><code><span lang=EN-GB
style='font-size:10.0pt'>42);<o:p></o:p></span></code></p>

<p class=MsoNormal><span class=GramE><code><span lang=EN-GB style='font-size:
10.0pt'>list.AddTail(</span></code></span><code><span lang=EN-GB
style='font-size:10.0pt'>99);<o:p></o:p></span></code></p>

<p class=MsoNormal><code><span lang=EN-GB style='font-size:10.0pt'><o:p>&nbsp;</o:p></span></code></p>

<p class=MsoNormal><span class=GramE><code><span lang=EN-GB style='font-size:
10.0pt'>ASSERT(</span></code></span><code><span lang=EN-GB style='font-size:
10.0pt'>list.GetHead() == 42);<o:p></o:p></span></code></p>

<p class=MsoNormal><span class=GramE><code><span lang=EN-GB style='font-size:
10.0pt'>ASSERT(</span></code></span><code><span lang=EN-GB style='font-size:
10.0pt'>list.GetTail() == 99);<o:p></o:p></span></code></p>

<p class=MsoNormal><span lang=EN-GB><o:p>&nbsp;</o:p></span></p>

<p class=MsoNormal><span lang=EN-GB>Around the same time as I was struggling to
grasp what I later discovered was a “recursive model” of lists (single item head
+ multi-itemed tail) I was also trying to learn Python. Unlike C++, where the
default container type was an array (</span><code><span lang=EN-GB
style='font-size:10.0pt'>std::vector</span></code><span lang=EN-GB>), Python
was presented around the list type and terms like “list comprehension” and
“cons operator” did very little to help me understand what was going on. It
didn’t help either that the list type smelt an awful lot like an array to me
and further talk of slices and shallow copies just seemed a far cry from the
safe world of C++ that I was used to.</span></p>

<p class=MsoNormal><span lang=EN-GB><o:p>&nbsp;</o:p></span></p>

<p class=MsoNormal><span lang=EN-GB>It’s probably no surprise I didn’t really
grok the list stuff in Python when I didn’t exactly understand the true power
of iterators in C++ either. For that light bulb moment to happen I had to read <st1:PersonName
w:st="on">Matthew Wilson</st1:PersonName>’s Extended <st1:stockticker w:st="on">STL</st1:stockticker>
book. Up until that point iterators seemed to me mostly just “clever” pointers,
but what Matthew’s book did was to show me the more the powerful idea of
representing other types of “collections” as sequences such as a file-system
directory or a database table. For example, to iterate over the files in a
folder using C++ 98 might go something like this:-</span></p>

<p class=MsoNormal><span lang=EN-GB><o:p>&nbsp;</o:p></span></p>

<p class=MsoNormal><code><span lang=EN-GB style='font-size:10.0pt'>FolderIterator
<span class=GramE>it(</span>“C:\\Temp”);<o:p></o:p></span></code></p>

<p class=MsoNormal><code><span lang=EN-GB style='font-size:10.0pt'>FolderIterator
end;<o:p></o:p></span></code></p>

<p class=MsoNormal><code><span lang=EN-GB style='font-size:10.0pt'><o:p>&nbsp;</o:p></span></code></p>

<p class=MsoNormal><span class=GramE><code><span lang=EN-GB style='font-size:
10.0pt'>for</span></code></span><code><span lang=EN-GB style='font-size:10.0pt'>
(; it != end; ++it)<o:p></o:p></span></code></p>

<p class=MsoNormal><code><span lang=EN-GB style='font-size:10.0pt'>{<o:p></o:p></span></code></p>

<p class=MsoNormal><code><span lang=EN-GB style='font-size:10.0pt'><span
style='mso-spacerun:yes'>    </span><span class=GramE>const</span>
std::string&amp; filename = *it;<o:p></o:p></span></code></p>

<p class=MsoNormal><code><span lang=EN-GB style='font-size:10.0pt'><span
style='mso-spacerun:yes'>    </span>. . .<o:p></o:p></span></code></p>

<p class=MsoNormal><code><span lang=EN-GB style='font-size:10.0pt'>}<o:p></o:p></span></code></p>

<p class=MsoNormal><span lang=EN-GB><o:p>&nbsp;</o:p></span></p>

<p class=MsoNormal><span lang=EN-GB>At around the same time I joined ACCU and
the first local branch meeting I attended was in <st1:place w:st="on"><st1:City
 w:st="on">Cambridge</st1:City></st1:place>. This was hosted by <st1:PersonName
w:st="on">Jez Higgins</st1:PersonName> and the title of the talk was “Iteration:
It's just one damn thing after another”. While I can’t claim to have understood
all the non-C++ variations it did begin to help cement my realisation that
containers are often just used as temporary storage for consuming a sequence.</span></p>

<p class=MsoNormal><span lang=EN-GB><o:p>&nbsp;</o:p></span></p>

<p class=MsoNormal><span lang=EN-GB>With this revolutionary (to me) mindset
under my belt the eventual transition from C++ to C# was somewhat easier
because its ubiquitous </span><code><span lang=EN-GB style='font-size:10.0pt'>IEnumerable</span></code><span
lang=EN-GB> type felt very similar to an iterator in C++ and the C# </span><code><span
lang=EN-GB style='font-size:10.0pt'>List&lt;T&gt;</span></code><span
lang=EN-GB> type was really just a </span><code><span lang=EN-GB
style='font-size:10.0pt'>std::vector&lt;T&gt;</span></code><span lang=EN-GB>.
In fact it wasn’t until I hit a performance anomaly in PowerShell that I even
knew C# had a classic linked-list type.</span></p>

<p class=MsoNormal><span lang=EN-GB><o:p>&nbsp;</o:p></span></p>

<p class=MsoNormal><span lang=EN-GB>Even with help from Boosts’ </span><code><span
lang=EN-GB style='font-size:10.0pt'>iterator_facade</span></code><span
lang=EN-GB> implementing simple iterators in C++ are still a chore. In contrast
the “</span><code><span lang=EN-GB style='font-size:10.0pt'>yield return</span></code><span
lang=EN-GB>” <span class=GramE>construct</span> in C# makes it a doddle because
the compiler builds a state machine under the covers for you so that your
function can become the internal algorithm for an iterator:-</span></p>

<p class=MsoNormal><span lang=EN-GB><o:p>&nbsp;</o:p></span></p>

<p class=MsoNormal><span class=GramE><code><span lang=EN-GB style='font-size:
10.0pt'>public</span></code></span><code><span lang=EN-GB style='font-size:
10.0pt'> IEnumerable&lt;int&gt; NumbersTo10()<o:p></o:p></span></code></p>

<p class=MsoNormal><code><span lang=EN-GB style='font-size:10.0pt'>{<o:p></o:p></span></code></p>

<p class=MsoNormal><code><span lang=EN-GB style='font-size:10.0pt'><span
style='mso-spacerun:yes'>    </span><span class=GramE>for</span> (int i = 1; i
!= 11; ++i)<o:p></o:p></span></code></p>

<p class=MsoNormal><code><span lang=EN-GB style='font-size:10.0pt'><span
style='mso-spacerun:yes'>        </span><span class=GramE>yield</span> return i;<o:p></o:p></span></code></p>

<p class=MsoNormal><code><span lang=EN-GB style='font-size:10.0pt'>}<o:p></o:p></span></code></p>

<p class=MsoNormal><code><span lang=EN-GB style='font-size:10.0pt'>. . .<o:p></o:p></span></code></p>

<p class=MsoNormal><code><span lang=EN-GB style='font-size:10.0pt'>IEnumerable&lt;int&gt;
range = <span class=GramE>NumbersTo10(</span>);<o:p></o:p></span></code></p>

<p class=MsoNormal><span class=GramE><code><span lang=EN-GB style='font-size:
10.0pt'>foreach</span></code></span><code><span lang=EN-GB style='font-size:
10.0pt'> (var number in range)<o:p></o:p></span></code></p>

<p class=MsoNormal><code><span lang=EN-GB style='font-size:10.0pt'><span
style='mso-spacerun:yes'>    </span><span class=GramE>sum</span> += number;<o:p></o:p></span></code></p>

<p class=MsoNormal><span lang=EN-GB><o:p>&nbsp;</o:p></span></p>

<p class=MsoNormal><span lang=EN-GB>Manually looping over a range like the numbers
1 to 10 is an algorithm that is fairly well ingrained in my muscle memory. When
I first saw this way of doing it I was bewildered:-</span></p>

<p class=MsoNormal><span lang=EN-GB><o:p>&nbsp;</o:p></span></p>

<p class=MsoNormal><span class=GramE><code><span lang=EN-GB style='font-size:
10.0pt'>var</span></code></span><code><span lang=EN-GB style='font-size:10.0pt'>
range = Enumerable.Range(1, 10);<o:p></o:p></span></code></p>

<p class=MsoNormal><span lang=EN-GB><o:p>&nbsp;</o:p></span></p>

<p class=MsoNormal><span lang=EN-GB>But of course it’s highly unlikely you’d pass
that to a </span><code><span lang=EN-GB style='font-size:10.0pt'>foreach</span></code><span
lang=EN-GB> loop, you’d use LINQ all the way and hide the loop entirely:-</span></p>

<p class=MsoNormal><span lang=EN-GB><o:p>&nbsp;</o:p></span></p>

<p class=MsoNormal><span class=GramE><code><span lang=EN-GB style='font-size:
10.0pt'>var</span></code></span><code><span lang=EN-GB style='font-size:10.0pt'>
sum = Enumerable.Range(1, 10)<o:p></o:p></span></code></p>

<p class=MsoNormal><code><span lang=EN-GB style='font-size:10.0pt'><span
style='mso-spacerun:yes'>                 </span><span
style='mso-spacerun:yes'>   </span>.<span class=GramE>Sum(</span>);<o:p></o:p></span></code></p>

<p class=MsoNormal><span lang=EN-GB><o:p>&nbsp;</o:p></span></p>

<p class=MsoNormal><span lang=EN-GB>I still felt deeply uncomfortable with
this. The classic “for” loop is simple and my C++ background meant I was fairly
certain the (<st1:stockticker w:st="on">JIT</st1:stockticker>) compiler would
translate it into some equally simple machine code. With the Enumerable method
I’m not so sure, it <i style='mso-bidi-font-style:normal'>feels</i> like there
are a few memory allocations going on there which just seems excessive. No
matter how much I might remind myself of the Parento Principle [2] (a.k.a. the
80 / 20 rule) it just seems gratuitous.</span></p>

<p class=MsoNormal><span lang=EN-GB><o:p>&nbsp;</o:p></span></p>

<p class=MsoNormal><span lang=EN-GB>Despite attending Oliver Sturm’s ACCU
conference session on F# way back in 2009 and listening to Don Syme himself
talk about F# to the <st1:stockticker w:st="on">BCS</st1:stockticker> a couple
of months later it has taken me until now to try and pick it up seriously. I
purchased a second hand copy of Programming F# and started reading it in the
background mostly as a way of gently introducing myself to some of the
functional programming concepts that I was aware of, like currying and partial
function application, but didn’t really know in depth.</span></p>

<p class=MsoNormal><span lang=EN-GB><o:p>&nbsp;</o:p></span></p>

<p class=MsoNormal><span lang=EN-GB>And then on page 33 I hit that term “list
comprehension” again, but this time the example (slightly modified below)
didn’t seem all that confusing:-</span></p>

<p class=MsoNormal><span lang=EN-GB><o:p>&nbsp;</o:p></span></p>

<p class=MsoNormal><span class=GramE><code><span lang=EN-GB style='font-size:
10.0pt'>let</span></code></span><code><span lang=EN-GB style='font-size:10.0pt'>
numbersTo10 = <o:p></o:p></span></code></p>

<p class=MsoNormal><code><span lang=EN-GB style='font-size:10.0pt'><span
style='mso-spacerun:yes'>    </span>[<o:p></o:p></span></code></p>

<p class=MsoNormal><code><span lang=EN-GB style='font-size:10.0pt'><span
style='mso-spacerun:yes'>        </span><span class=GramE>for</span> i in 1..10
do<o:p></o:p></span></code></p>

<p class=MsoNormal><code><span lang=EN-GB style='font-size:10.0pt'><span
style='mso-spacerun:yes'>            </span><span class=GramE>yield</span> i<o:p></o:p></span></code></p>

<p class=MsoNormal><code><span lang=EN-GB style='font-size:10.0pt'><span
style='mso-spacerun:yes'>    </span>]<o:p></o:p></span></code></p>

<p class=MsoNormal><span lang=EN-GB><o:p>&nbsp;</o:p></span></p>

<p class=MsoNormal><span lang=EN-GB>In fact it looked <i style='mso-bidi-font-style:
normal'>very</i> similar to the C# equivalent. Suddenly the mystique was gone –
a “list comprehension” is just a list generated by some algorithm. I remember
reading a tweet once suggesting “list comprehension” was probably up there in
the top 10 badly named computer science terms. To me “sequence generation”
seems a more suitable term.</span></p>

<p class=MsoNormal><span lang=EN-GB><o:p>&nbsp;</o:p></span></p>

<p class=MsoNormal><span lang=EN-GB>But hold on, that term doesn’t seem quite right
either; perhaps “list generation” would be more appropriate. But why would you
generate a list, which takes up valuable space, from a lazily evaluate-able
sequence which takes virtually no space at all, except as an optimisation for
further iteration?</span></p>

<p class=MsoNormal><span lang=EN-GB><o:p>&nbsp;</o:p></span></p>

<p class=MsoNormal><span lang=EN-GB>It feels like I’ve discovered the beauty of
lazily evaluated sequences with iterators in C++ and </span><code><span
lang=EN-GB style='font-size:10.0pt'>IEnumerable</span></code><span lang=EN-GB>
in C# and now consequently discovered what list comprehensions are. But in
return I’m now questioning why so much importance seems to be placed on them
when sequences and pipelines appear to offer so much more value. Will my
journey never end?</span></p>

<h3><span lang=EN-GB>References</span></h3>

<p class=MsoNormal><span lang=EN-GB>[1] <a
href="http://chrisoldwood.blogspot.co.uk/2013/06/a-tail-of-two-lists.html">http://chrisoldwood.blogspot.co.uk/2013/06/a-tail-of-two-lists.html</a></span></p>

<p class=MsoNormal><span lang=EN-GB>[2] <a
href="http://en.wikipedia.org/wiki/Pareto_principle">http://en.wikipedia.org/wiki/Pareto_principle</a></span></p>

<p class=MsoNormal><span lang=EN-GB><o:p>&nbsp;</o:p></span></p>

<p class=MsoNormal><st1:PersonName w:st="on"><span lang=EN-GB>Chris Oldwood</span></st1:PersonName></p>

<p class=MsoNormal><!--[if supportFields]><span lang=EN-GB><span
style='mso-element:field-begin'></span><span
style='mso-spacerun:yes'> </span>SAVEDATE<span style='mso-spacerun:yes'> 
</span>\@ &quot;dd MMMM yyyy&quot;<span style='mso-spacerun:yes'>  </span>\*
MERGEFORMAT <span style='mso-element:field-separator'></span></span><![endif]--><span
lang=EN-GB><span style='mso-no-proof:yes'>17 April 2014</span></span><!--[if supportFields]><span
lang=EN-GB><span style='mso-element:field-end'></span></span><![endif]--></p>

<p class=MsoNormal><span lang=EN-GB><o:p>&nbsp;</o:p></span></p>

<p class=MsoNormal><u><span lang=EN-GB>Bio<o:p></o:p></span></u></p>

<p class=MsoNormal><span lang=EN-GB>Chris is a freelance developer who started
out as a bedroom coder in the 80’s writing assembler on 8-bit micros; these
days it’s C++ and C#. He also commentates on the Godmanchester duck race and
can be contacted via <a href="mailto:gort@cix.co.uk">gort@cix.co.uk</a> or
@chrisoldwood.</span></p>

</div>

</body>

</html>
